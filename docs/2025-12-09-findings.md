# Maestro Findings — 2025-12-09

Scope: code quality, Rust idioms, UX consistency. Code works today; focus is cleanliness and predictability.

## High
- **Pane deduplication missing during spawn/update** (`src/handlers/panes.rs:27-88`, `src/handlers/session.rs:48-150`): Spawning pushes a placeholder with `pane_id=None`; `apply_pane_update` later pushes another entry once an ID is observed; `handle_command_pane_opened` updates only the first match. This leaves duplicate rows and can focus/kill the wrong pane. *Recommendation:* when processing pane updates/opened events, match by pane title/context before pushing; drop or coalesce placeholders once `pane_id` is known.

## Medium
- **Tab list stale on session change** (`src/handlers/session.rs:277-293`): `handle_session_update` resets `session_name` and panes but never refreshes `tab_names` from `SessionInfo`. Until a later `TabUpdate`, the wizard believes no tabs exist and always picks `TabChoice::New`, causing extra tabs or focus failures. *Recommendation:* hydrate `tab_names` from the session payload (positions/names) during the update.

## Low / UX
- **Fuzzy suggestions sorted lexicographically** (`src/utils.rs:90-118`): Path autocomplete filters with `SkimMatcherV2` but sorts alphabetically, so top suggestions aren’t the best matches. *Recommendation:* sort by score (desc), then by name as tiebreaker before slicing to the displayed window.

## Testing Gaps
- Event flows lack coverage (`src/handlers/session.rs`, `src/handlers/panes.rs`): No tests guard spawn → pane update → opened lifecycle, tab-name resolution, or permission gating. *Recommendation:* add unit/integration-style tests for deduping, tab-name refresh, and permission failures; include regressions for “edit default agent” behavior once policy is set.

## Resolved Since Findings Opened
- Default agents can now be overridden: `persist_agents` writes the full agent list instead of stripping built-ins (`src/handlers/forms.rs:133-146`), and `load_agents_default` merges user entries over defaults, so edits to `cursor`/`claude`/etc. are preserved.

## Suggested Checks
- `cargo test`
- If policy changes: targeted tests for agent persistence (default vs. custom), pane deduping on update/open, and tab-name refresh on session update.
