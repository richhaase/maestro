# Maestro Findings — 2025-12-09

Scope: code quality, Rust idioms, UX consistency. Code works today; focus is cleanliness and predictability.

## Testing Gaps
- Event flows lack coverage (`src/handlers/session.rs`, `src/handlers/panes.rs`): No tests guard spawn → pane update → opened lifecycle, tab-name resolution, or permission gating. *Recommendation:* add unit/integration-style tests for deduping, tab-name refresh, and permission failures; include regressions for “edit default agent” behavior once policy is set.

## Resolved Since Findings Opened
- Default agents can now be overridden: `persist_agents` writes the full agent list instead of stripping built-ins (`src/handlers/forms.rs:133-146`), and `load_agents_default` merges user entries over defaults, so edits to `cursor`/`claude`/etc. are preserved.
- Path suggestions now sort by fuzzy score (`src/utils.rs:90-118`): ordering is score-first then name; added regression test `test_get_path_suggestions_sorted_by_score`.
- Pane dedup issue mitigated by removing optimistic placeholder and exiting after spawn (`src/handlers/panes.rs`, `src/handlers/keys.rs`): panes now rely on actual Zellij updates; duplicates from spawn-time placeholders are gone.
- Tab list now hydrated during session updates (`src/handlers/session.rs`): `handle_session_update` populates `tab_names` from `SessionInfo`; regression test `tab_names_hydrate_on_session_update` added.

## Suggested Checks
- `cargo test`
- If policy changes: targeted tests for agent persistence (default vs. custom), pane deduping on update/open, and tab-name refresh on session update.
